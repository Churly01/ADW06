SET 'auto.offset.reset'='earliest';

CREATE STREAM IF NOT EXISTS adw06_monitor (
	idrt INT,
	IP STRING,
	UAID STRING,
	NV INT,
	UV TIMESTAMP,
	rtreg TIMESTAMP)
WITH (KAFKA_TOPIC='adw.adw06.monitor', VALUE_FORMAT='JSON');

CREATE STREAM IF NOT EXISTS adw06_keymon
	WITH (KAFKA_TOPIC='adw.adw06.keymon', KEY_FORMAT='AVRO', VALUE_FORMAT='AVRO')
	AS SELECT
		NV, UV, rtreg,
		STRUCT(IP:=IP, UAID:=UAID) AS KEY
	FROM ADW06_MONITOR
	PARTITION BY STRUCT(IP:=IP, UAID:=UAID);